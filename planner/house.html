<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JSON Driven House Manager</title>
    <style>
        body { font-family: system-ui, sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 600px; margin: auto; background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .task-card { border: 1px solid #eee; margin-bottom: 1rem; padding: 1rem; border-radius: 8px; transition: transform 0.1s; }
        .task-card:hover { transform: translateY(-2px); border-color: #3498db; }
        .controls { display: flex; gap: 10px; margin-top: 10px; }
        button { flex: 1; padding: 10px; cursor: pointer; border-radius: 5px; border: none; font-weight: 600; }
        .btn-done { background: #27ae60; color: white; }
        .btn-snooze { background: #3498db; color: white; }
        .status-msg { color: #7f8c8d; font-size: 0.9rem; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üè† House Tasks</h1>
    <div id="task-list">Loading chores from JSON...</div>
    <p id="status" class="status-msg"></p>
</div>

<script>
    let tasks = [];

    // 1. FETCH the data from your house.json file
    async function loadTasks() {
        try {
            const response = await fetch('house.json');
            if (!response.ok) throw new Error("Could not find house.json");
            tasks = await response.json();
            renderTasks();
            document.getElementById('status').innerText = "Data loaded successfully.";
        } catch (err) {
            document.getElementById('task-list').innerHTML = 
                `<p style="color:red">Error: ${err.message}<br>Note: You must run this via a local server (like Live Server) for fetch to work.</p>`;
        }
    }

    function renderTasks() {
        const list = document.getElementById('task-list');
        list.innerHTML = '';
        
        tasks.sort((a, b) => new Date(a.due) - new Date(b.due));

        tasks.forEach(task => {
            const dueDate = new Date(task.due);
            const card = document.createElement('div');
            card.className = 'task-card';
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between">
                    <strong>${task.name}</strong>
                    <span style="color:#e67e22">${dueDate.toLocaleDateString()}</span>
                </div>
                <div class="controls">
                    <button class="btn-done" onclick="updateTask(${task.id}, 'DONE')">Complete</button>
                    <button class="btn-snooze" onclick="updateTask(${task.id}, 'SNOOZE')">Snooze</button>
                </div>
            `;
            list.appendChild(card);
        });
    }

    function updateTask(id, action) {
        const task = tasks.find(t => t.id === id);
        let dateObj = new Date(task.due);

        if (action === 'SNOOZE') {
            dateObj.setDate(dateObj.getDate() + 1);
        } else if (action === 'DONE') {
            if (task.type === "FIXED") {
                // Next week/month based on when it was DUE
                dateObj.setDate(dateObj.getDate() + task.intervalDays);
            } else {
                // Next interval based on TODAY
                dateObj = new Date();
                dateObj.setDate(dateObj.getDate() + task.intervalDays);
            }
        }

        task.due = dateObj.toISOString();
        renderTasks();
        
        console.log("Updated Data (Ready to save):", JSON.stringify(tasks, null, 2));
        document.getElementById('status').innerText = `Updated ${task.name}. Note: Browser can't auto-save back to JSON file for security.`;
    }

    loadTasks();
</script>
</body>
</html>
