function renderLedger(data) {
        const body = document.getElementById('ledgerBody');
        body.innerHTML = '';
        
        if (!data.history || data.history.length === 0) {
            body.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">No transactions found.</td></tr>';
            return;
        }

        // 1. Better sorting logic that handles potential bad date strings
        const sortedHistory = data.history.slice().sort((a, b) => {
            return new Date(b.date.replace(/-/g, '/')) - new Date(a.date.replace(/-/g, '/'));
        });

        sortedHistory.forEach(item => {
            const isPos = item.amount > 0;
            
            // 2. Robust Date Parsing: Replaces dashes with slashes for Safari/iOS compatibility
            let dateStr;
            try {
                const dateParts = item.date.split('-');
                if (dateParts.length === 3) {
                    // Manually creating a date to avoid timezone shifting
                    const d = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                    dateStr = d.toLocaleDateString(undefined, {month: 'short', day: 'numeric'});
                } else {
                    dateStr = item.date; // Fallback to raw text
                }
            } catch (e) {
                dateStr = "---";
            }
            
            let metaInfo = [];
            if (item.who) metaInfo.push(item.who);
            if (item.what) metaInfo.push(item.what);
            if (item.category === 'SAVINGS') metaInfo.push("Savings Transfer");

            const row = `
                <tr>
                    <td>${dateStr}</td>
                    <td>
                        <b>${item.vendor}</b>
                        <span class="meta">${metaInfo.join(' â€¢ ')}</span>
                    </td>
                    <td style="text-align:right;" class="${isPos ? 'amt-pos' : 'amt-neg'}">
                        ${isPos ? '+' : ''}$${Math.abs(parseFloat(item.amount)).toLocaleString(undefined, {minimumFractionDigits: 2})}
                    </td>
                </tr>
            `;
            body.innerHTML += row;
        });
    }
