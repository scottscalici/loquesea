<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Budget Tracker</title>
    <style>
        :root { --primary: #2e7d32; --accent: #2196F3; --bg: #f4f4f9; --card: #ffffff; --text: #333; --danger: #d32f2f; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: var(--text); padding-top: 20px; }
        
        .card { background: var(--card); border-radius: 16px; padding: 30px 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; text-align: center; }
        .label { font-size: 0.8rem; color: #888; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }
        
        /* The "Giant Number" */
        .pacing-val { font-size: 4.5rem; font-weight: 800; color: var(--primary); margin: 15px 0; line-height: 1; }
        .sub-text { color: #666; font-size: 1rem; font-weight: 500; }
        
        /* The Progress Bar */
        .progress-container { background: #e0e0e0; height: 30px; border-radius: 15px; margin: 25px 0; position: relative; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); width: 0%; }
        .target-marker { position: absolute; top: 0; width: 4px; height: 100%; background: #333; z-index: 2; }
        
        .progress-label { display: flex; justify-content: space-between; font-size: 0.85rem; color: #555; font-weight: bold; margin-top: -15px; }
        .status-msg { margin-top: 25px; font-size: 1.1rem; font-weight: bold; padding: 10px; border-radius: 8px; }
        
        /* Auto-Refresh Indicator */
        .refresh-tag { font-size: 0.65rem; color: #bbb; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="card">
        <span class="label">Available for Today</span>
        <div class="pacing-val" id="dailyPacing">$0</div>
        <div class="sub-text" id="daysLeftMsg">...</div>
    </div>

    <div class="card">
        <span class="label">Weekly Spending Progress</span>
        <div class="progress-container">
            <div id="targetMarker" class="target-marker"></div>
            <div id="spendFill" class="progress-fill"></div>
        </div>
        <div class="progress-label">
            <span>Spent: <span id="amtSpent">$0</span></span>
            <span>Target: <span id="amtTarget">$0</span></span>
        </div>
        <div id="pacingMsg" class="status-msg"></div>
    </div>

    <div class="refresh-tag">Updates automatically when transactions are logged</div>

<script>
    const CONFIG = { owner: 'scottscalici', repo: 'loquesea', path: 'planner/bills.json' };

    async function fetchData() {
        try {
            // Adding a timestamp to the URL to bypass browser caching
            const resp = await fetch(`bills.json?t=${Date.now()}`);
            const data = await resp.json();
            render(data);
        } catch (e) {
            console.error("Data fetch failed");
        }
    }

    function render(data) {
        const totalWeekly = 1000;
        const remaining = data.state.current_weekly_remaining;
        const spent = totalWeekly - remaining;
        
        const now = new Date();
        const dayOfWeek = now.getDay() || 7; 
        const daysLeft = (8 - dayOfWeek);
        const targetSpend = (totalWeekly / 7) * dayOfWeek;

        // 1. Update Numbers
        document.getElementById('dailyPacing').innerText = `$${Math.floor(remaining / daysLeft)}`;
        document.getElementById('daysLeftMsg').innerText = `${daysLeft} days left in the week`;
        document.getElementById('amtSpent').innerText = '$' + Math.round(spent);
        document.getElementById('amtTarget').innerText = '$' + Math.round(targetSpend);

        // 2. Update Progress Bar
        const spendPct = Math.min((spent / totalWeekly) * 100, 100);
        const targetPct = Math.min((targetSpend / totalWeekly) * 100, 100);
        
        document.getElementById('spendFill').style.width = spendPct + '%';
        document.getElementById('targetMarker').style.left = targetPct + '%';

        // 3. Pacing Message
        const diff = targetSpend - spent;
        const msg = document.getElementById('pacingMsg');
        if (diff >= 0) {
            msg.innerText = `✅ $${Math.round(diff)} Under Weekly Average`;
            msg.style.color = "var(--primary)";
            msg.style.backgroundColor = "#e8f5e9";
            document.getElementById('spendFill').style.background = "var(--primary)";
        } else {
            msg.innerText = `⚠️ $${Math.round(Math.abs(diff))} Over Weekly Average`;
            msg.style.color = "var(--danger)";
            msg.style.backgroundColor = "#ffebee";
            document.getElementById('spendFill').style.background = "var(--danger)";
        }
    }

    // Initialize and set to refresh every 5 minutes in case she leaves the tab open
    fetchData();
    setInterval(fetchData, 300000); 
</script>
</body>
</html>
