<div class="card" style="border-left: 5px solid #2196F3;">
    <div style="display:flex; justify-content: space-between; align-items: center;">
        <span class="label">Est. Checking Balance</span>
        <b id="checkingDisplay" style="font-size: 1.5rem; color: #2196F3;">$0.00</b>
    </div>
    <hr style="border:0; border-top:1px solid #eee; margin: 15px 0;">
    
    <h4>Log a Purchase</h4>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <input type="text" id="buyWho" placeholder="Who (e.g. Scott)">
        <input type="text" id="buyWhat" placeholder="What (e.g. Dinner)">
        <input type="number" id="buyAmount" placeholder="$ Amount">
        <button class="paid-btn" style="background:#2196F3;" onclick="logPurchase()">Log & Deduct</button>
    </div>
    <p style="font-size: 0.7rem; color: #888; margin-top: 10px;">*Standard purchases deduct from Weekly Pacing. Amazon deductions check Escrow first.</p>
</div>

<script>
    // --- NEW LOGIC TO ADD TO YOUR SCRIPT SECTION ---

    // 1. Update Checking on Bill Pay
    async function payBill(id) {
        const bill = budgetData.bills.find(b => b.id === id);
        
        // DEDUCT FROM CHECKING
        budgetData.state.checking_balance -= bill.amount;

        // DATE JUMP LOGIC (Same as before)
        const date = new Date(bill.next_due_date);
        if (bill.frequency === "monthly") date.setMonth(date.getMonth() + 1);
        else if (bill.frequency === "bi-weekly") date.setDate(date.getDate() + 14);
        else if (bill.frequency === "annually") date.setFullYear(date.getFullYear() + 1);
        
        bill.next_due_date = date.toISOString().split('T')[0];
        
        await saveToGitHub();
        renderApp();
    }

    // 2. Log a Purchase (Deducts from Weekly Pacing)
    async function logPurchase() {
        const who = document.getElementById('buyWho').value;
        const what = document.getElementById('buyWhat').value;
        const amt = parseFloat(document.getElementById('buyAmount').value);

        if (!amt) return;

        // Logic for Amazon Escrow (Section 1)
        if (what.toLowerCase().includes("amazon") && budgetData.state.escrow_remaining > 0) {
            if (budgetData.state.escrow_remaining >= amt) {
                budgetData.state.escrow_remaining -= amt;
            } else {
                const remainder = amt - budgetData.state.escrow_remaining;
                budgetData.state.escrow_remaining = 0;
                budgetData.state.current_weekly_remaining -= remainder;
            }
        } else {
            // Normal Purchase
            budgetData.state.current_weekly_remaining -= amt;
        }

        // Also deduct from checking balance
        budgetData.state.checking_balance -= amt;

        // Clear inputs
        document.getElementById('buyWho').value = '';
        document.getElementById('buyWhat').value = '';
        document.getElementById('buyAmount').value = '';

        showStatus(`Logged ${what} for $${amt}`);
        await saveToGitHub();
        renderApp();
    }

    // 3. Add to renderApp()
    function renderApp() {
        // ... (Keep existing pacing math) ...
        document.getElementById('checkingDisplay').innerText = `$${budgetData.state.checking_balance.toLocaleString()}`;
        // ...
    }
</script>
